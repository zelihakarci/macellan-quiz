{"version":3,"sources":["useCarouselController.tsx"],"names":["useCarouselController","opts","width","loop","handlerOffsetX","timingConfig","lockController","indexController","disable","canSliding","React","useCallback","isLock","onScrollEnd","unLock","onScrollBegin","lock","next","index","value","length","isFinished","prev","to","animated","offset"],"mappings":"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","sourcesContent":["import React from 'react';\nimport type Animated from 'react-native-reanimated';\nimport { runOnJS, withTiming } from 'react-native-reanimated';\nimport type { IIndexController } from './useIndexController';\nimport type { ILockController } from './useLock';\n\ninterface IOpts {\n    loop: boolean;\n    width: number;\n    handlerOffsetX: Animated.SharedValue<number>;\n    lockController: ILockController;\n    indexController: IIndexController;\n    timingConfig: Animated.WithTimingConfig;\n    disable?: boolean;\n    onScrollBegin?: () => void;\n    onScrollEnd?: () => void;\n}\n\nexport interface ICarouselController {\n    prev: () => void;\n    next: () => void;\n    to: (index: number, animated?: boolean) => void;\n}\n\nexport function useCarouselController(opts: IOpts): ICarouselController {\n    const {\n        width,\n        loop,\n        handlerOffsetX,\n        timingConfig,\n        lockController,\n        indexController,\n        disable = false,\n    } = opts;\n\n    const canSliding = React.useCallback(() => {\n        return !disable && !lockController.isLock();\n    }, [lockController, disable]);\n\n    const onScrollEnd = React.useCallback(() => {\n        lockController.unLock();\n        opts.onScrollEnd?.();\n    }, [lockController, opts]);\n\n    const onScrollBegin = React.useCallback(() => {\n        opts.onScrollBegin?.();\n        lockController.lock();\n    }, [lockController, opts]);\n\n    const next = React.useCallback(() => {\n        if (\n            !canSliding() ||\n            (!loop &&\n                indexController.index.value === indexController.length - 1)\n        )\n            return;\n\n        onScrollBegin?.();\n\n        handlerOffsetX.value = withTiming(\n            handlerOffsetX.value - width,\n            timingConfig,\n            (isFinished: boolean) => {\n                if (isFinished) {\n                    runOnJS(onScrollEnd)();\n                }\n            }\n        );\n    }, [\n        onScrollEnd,\n        canSliding,\n        onScrollBegin,\n        width,\n        timingConfig,\n        handlerOffsetX,\n        indexController,\n        loop,\n    ]);\n\n    const prev = React.useCallback(() => {\n        if (!canSliding() || (!loop && indexController.index.value === 0))\n            return;\n\n        onScrollBegin?.();\n\n        handlerOffsetX.value = withTiming(\n            handlerOffsetX.value + width,\n            timingConfig,\n            (isFinished: boolean) => {\n                if (isFinished) {\n                    runOnJS(onScrollEnd)();\n                }\n            }\n        );\n    }, [\n        onScrollEnd,\n        canSliding,\n        onScrollBegin,\n        width,\n        timingConfig,\n        handlerOffsetX,\n        indexController,\n        loop,\n    ]);\n\n    const to = React.useCallback(\n        (index: number, animated: boolean = false) => {\n            if (index === indexController.index.value) return;\n            if (!canSliding()) return;\n\n            onScrollBegin?.();\n\n            const offset =\n                handlerOffsetX.value +\n                (indexController.index.value - index) * width;\n\n            if (animated) {\n                handlerOffsetX.value = withTiming(\n                    offset,\n                    timingConfig,\n                    (isFinished: boolean) => {\n                        indexController.index.value = index;\n                        if (isFinished) {\n                            runOnJS(onScrollEnd)();\n                        }\n                    }\n                );\n            } else {\n                handlerOffsetX.value = offset;\n                indexController.index.value = index;\n                runOnJS(onScrollEnd)();\n            }\n        },\n        [\n            canSliding,\n            onScrollBegin,\n            onScrollEnd,\n            width,\n            timingConfig,\n            indexController,\n            handlerOffsetX,\n        ]\n    );\n\n    return {\n        next,\n        prev,\n        to,\n    };\n}\n"]}